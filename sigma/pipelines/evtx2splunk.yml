name: Windows Field Mapping 
priority: 30
transformations:
  - id: field_mapping
    type: field_name_mapping
    mapping:
        Provider_Name: "Provider.#attributes.EventSourceName"
    rule_conditions:
      - type: logsource
        product: windows
        service: system

name: Splunk Alert stanza
priority: 10
postprocessing:
- type: template
  template: |+
    [{{ rule.title }}]
    description = {{ rule.description }}
    search = index=evtx _index_earliest=-1h@h | rename Event.EventData.* as *  Event.System.* as * | search {{ query }} | fields - _raw | collect index=notable_events source="{{ rule.title }}" marker="guid={{ rule.id }}"
  rule_conditions:
  - type: logsource
    product: windows


finalizers:
- type: template
  template: |
    [default]
    cron_schedule = */30 * * * *
    dispatch.earliest_time = 0
    dispatch.latest_time = now
    enableSched = 0
    schedule_window = auto
    {{ queries | join('\n') }}
